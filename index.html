<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <title>é³´çŸ³ãƒ†ãƒ¬ã‚¤ãƒ³ æ¤ç”Ÿè§£æãƒãƒƒãƒ—</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://unpkg.com/maplibre-gl@4.1.2/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/maplibre-gl@4.1.2/dist/maplibre-gl.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Helvetica Neue', Arial, sans-serif; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        
        .info-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            max-width: 280px;
            z-index: 1000;
        }
        .info-panel h1 {
            font-size: 16px;
            margin-bottom: 5px;
            color: #333;
        }
        .info-panel p {
            font-size: 11px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .legend {
            position: absolute;
            bottom: 30px;
            right: 10px;
            background: rgba(255, 255, 255, 0.95);
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            font-size: 12px;
            z-index: 1000;
        }
        .legend h3 {
            font-size: 13px;
            margin-bottom: 8px;
            color: #333;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 4px 0;
        }
        .legend-color {
            width: 24px;
            height: 18px;
            margin-right: 8px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        
        .controls {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.95);
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        .controls label {
            display: flex;
            align-items: center;
            font-size: 13px;
            margin: 5px 0;
            cursor: pointer;
        }
        .controls input[type="checkbox"] {
            margin-right: 8px;
        }
        .controls input[type="range"] {
            width: 100px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div class="info-panel">
        <h1>ğŸŒ² é³´çŸ³ãƒ†ãƒ¬ã‚¤ãƒ³ æ¤ç”Ÿè§£æ</h1>
        <p>å±±æ¢¨çœŒèˆªç©ºãƒ¬ãƒ¼ã‚¶ç‚¹ç¾¤ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ç”Ÿæˆã—ãŸ<br>ISOM2017-2æº–æ‹ ã®èµ°è¡Œå¯èƒ½åº¦ãƒãƒƒãƒ—</p>
        <p style="font-size: 10px; color: #999;">
            å‡ºå…¸ï¼šå±±æ¢¨çœŒ ç‚¹ç¾¤ãƒ‡ãƒ¼ã‚¿ï¼ˆ2024ï¼‰<br>
            ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ï¼šCC BY 4.0
        </p>
    </div>
    
    <div class="controls">
        <label>
            <input type="checkbox" id="toggleVegetation" checked>
            æ¤ç”Ÿãƒ¬ã‚¤ãƒ¤è¡¨ç¤º
        </label>
        <label>
            é€æ˜åº¦:
            <input type="range" id="opacitySlider" min="0" max="100" value="70">
        </label>
        <hr style="margin: 10px 0; border: none; border-top: 1px solid #ddd;">
        <label>
            <input type="radio" name="basemap" value="photo" checked>
            èˆªç©ºå†™çœŸ
        </label>
        <label>
            <input type="radio" name="basemap" value="osm">
            OpenStreetMap
        </label>
        <label>
            <input type="radio" name="basemap" value="pale">
            åœ°ç†é™¢æ·¡è‰²
        </label>
    </div>
    
    <div class="legend">
        <h3>èµ°è¡Œå¯èƒ½åº¦ï¼ˆISOMï¼‰</h3>
        <div class="legend-item">
            <div class="legend-color" style="background: #FFFFFF;"></div>
            è‰¯å¥½ï¼ˆ95.0%ï¼‰
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #CEF7BB;"></div>
            ã‚„ã‚„é…ã„ï¼ˆ4.5%ï¼‰
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #9DF076;"></div>
            å›°é›£ï¼ˆ0.4%ï¼‰
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: #60E520;"></div>
            éå¸¸ã«å›°é›£ï¼ˆ0.0%ï¼‰
        </div>
    </div>
    
    <script>
        // é³´çŸ³ãƒ†ãƒ¬ã‚¤ãƒ³ã®ä¸­å¿ƒåº§æ¨™
        const CENTER = [138.378, 35.878];
        const ZOOM = 15;
        
        // ã‚¿ã‚¤ãƒ«URLï¼ˆGitHub Pagesï¼‰
        const VEGETATION_TILES = 'https://trilor.github.io/naruishi-map/{z}/{x}/{y}.png';
        
        // ãƒ™ãƒ¼ã‚¹ãƒãƒƒãƒ—ã‚½ãƒ¼ã‚¹
        const BASEMAPS = {
            photo: {
                tiles: ['https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/{z}/{x}/{y}.jpg'],
                attribution: 'Â© å›½åœŸåœ°ç†é™¢'
            },
            osm: {
                tiles: ['https://tile.openstreetmap.org/{z}/{x}/{y}.png'],
                attribution: 'Â© OpenStreetMap contributors'
            },
            pale: {
                tiles: ['https://cyberjapandata.gsi.go.jp/xyz/pale/{z}/{x}/{y}.png'],
                attribution: 'Â© å›½åœŸåœ°ç†é™¢'
            }
        };
        
        // ãƒãƒƒãƒ—åˆæœŸåŒ–
        const map = new maplibregl.Map({
            container: 'map',
            style: {
                version: 8,
                sources: {
                    'basemap': {
                        type: 'raster',
                        tiles: BASEMAPS.photo.tiles,
                        tileSize: 256,
                        attribution: BASEMAPS.photo.attribution
                    },
                    'vegetation': {
                        type: 'raster',
                        tiles: [VEGETATION_TILES],
                        tileSize: 256,
                        attribution: 'æ¤ç”Ÿè§£æ: å±±æ¢¨çœŒç‚¹ç¾¤ãƒ‡ãƒ¼ã‚¿ï¼ˆ2024ï¼‰'
                    }
                },
                layers: [
                    {
                        id: 'basemap-layer',
                        type: 'raster',
                        source: 'basemap'
                    },
                    {
                        id: 'vegetation-layer',
                        type: 'raster',
                        source: 'vegetation',
                        paint: {
                            'raster-opacity': 0.7
                        }
                    }
                ]
            },
            center: CENTER,
            zoom: ZOOM
        });
        
        // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
        map.addControl(new maplibregl.NavigationControl());
        map.addControl(new maplibregl.ScaleControl({ unit: 'metric' }));
        
        // æ¤ç”Ÿãƒ¬ã‚¤ãƒ¤è¡¨ç¤ºåˆ‡æ›¿
        document.getElementById('toggleVegetation').addEventListener('change', (e) => {
            map.setLayoutProperty('vegetation-layer', 'visibility', 
                e.target.checked ? 'visible' : 'none');
        });
        
        // é€æ˜åº¦èª¿æ•´
        document.getElementById('opacitySlider').addEventListener('input', (e) => {
            map.setPaintProperty('vegetation-layer', 'raster-opacity', 
                parseInt(e.target.value) / 100);
        });
        
        // ãƒ™ãƒ¼ã‚¹ãƒãƒƒãƒ—åˆ‡æ›¿
        document.querySelectorAll('input[name="basemap"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                const basemap = BASEMAPS[e.target.value];
                map.getSource('basemap').tiles = basemap.tiles;
                map.style.sources.basemap.tiles = basemap.tiles;
                map.triggerRepaint();
                // ã‚¿ã‚¤ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¦å†èª­ã¿è¾¼ã¿
                map.style.sourceCaches['basemap'].clearTiles();
                map.style.sourceCaches['basemap'].update(map.transform);
            });
        });
    </script>
</body>
</html>
